(SearchAlgorithm "PN-MCTS"
  (Define C 0.6)
  (Define T 5)
  (Define value 0)
  
  (Selection "UCT"
    (Condition (eq nodeType maxNode)
      (SelectNode argmax
        (Condition (or (lte visitCount T) (and (neq proofNumber 0) (neq disproofNumber 0)))
          (+ valueEstimate (* C (sqrt (/ (log (Parent visitCount)) visitCount))))
        )
      )
    )
    (Condition (eq nodeType minNode)
      (SelectNode argmax
        (Condition (or (lte visitCount T) (and (neq proofNumber 0) (neq disproofNumber 0)))
          (+ (- 0 valueEstimate) (* C (sqrt (/ (log (Parent visitCount)) visitCount))))
        )
      )
    )
  )
  (Evaluation
    (Set value (ExternalFunction "mctsEval" node))
    (Set proofValue (ExternalFunction "pnsEval" node))
    (Condition (eq proofValue true)
      (Set proofNumber 0)
      (Set disproofNumber inf)
    )
    (Condition (eq proofValue false)
      (Set proofNumber inf)
      (Set disproofNumber 0)
    )
    (Condition (eq proofValue unknown)
      (Condition (eq nodeType orNode)
        (Set proofNumber 1)
        (Set disproofNumber numChildren)
      )
      (Condition (eq nodeType andNode)
        (Set proofNumber numChildren)
        (Set disproofNumber 1)
      )
    )
  )
  (Backpropagation
    (Set valueEstimate (+ valueEstimate (/ (- value valueEstimate) visitCount)))
    (Condition (eq nodeType orNode)
      (Set proofNumber (Aggregate min proofNumber))
      (Set disproofNumber (Aggregate sum disproofNumber))
    )
    (Condition (eq nodeType andNode)
      (Set proofNumber (Aggregate sum proofNumber))
      (Set disproofNumber (Aggregate min disproofNumber))
    )
  )
  (FinalMoveSelection
    (Condition (eq proofNumber 0)
      (SelectNode argmin proofNumber)
    )
    (Condition (neq proofNumber 0)
      (SelectNode argmax visitCount)
    )
  )
)
